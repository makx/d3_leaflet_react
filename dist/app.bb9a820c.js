(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(t,e,r){r(135),t.exports=r(198)},140:function(t,e,r){},146:function(t,e,r){},198:function(t,e,r){"use strict";r.r(e);r(140);var n=r(0),a=r.n(n),o=r(22),u=(r(146),r(3)),c=r(101),i=r(100),s=r(120),l=r(99),p=r(121),f=r.n(p),d=r(199);r(148);var h=a.a.createElement("h2",null,"Ventas en España y Portugal"),m=a.a.createElement(c.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),y=a.a.createElement(i.a,null,"A pretty CSS3 popup. ",a.a.createElement("br",null)," Easily customizable."),b=function(t){function e(r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.state={lat:40.41,lng:-3.7,zoom:5.5},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.render=function(){var t=this.props.data,e=[this.state.lat,this.state.lng];return a.a.createElement(d.a,{xs:12,sm:12,md:4},h,a.a.createElement(s.a,{className:"map-spain",center:e,zoom:this.state.zoom},m,a.a.createElement(f.a,null,t.length&&t.map(function(t,e){return a.a.createElement(l.a,{key:e,position:{lat:t.latitude,lng:t.longitude}},y)}))))},e}(n.Component);var v=a.a.createElement(d.a,{xs:12,sm:12,md:8},a.a.createElement("h2",null,"Ventas por Fabricante"),a.a.createElement("div",{className:"bar-chart"})),g=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentWillUnmount=function(){u.select(".bar-chart > *").remove()},e.prototype.render=function(){var t=this.props,e=t.purchasesByManufacturer;t.purchasesByProduct;u.select(".bar-chart > *").remove();var r=e.slice(0,9).map(function(t){return{label:t.key,value:Math.round(10*t.value.income)/10}});return this.drawChart(r),v},e.prototype.drawChart=function(t){var e=20,r=80,n=80,a=40,o=u.select(".bar-chart").append("svg").attr("id","chart").attr("width",700).attr("height",450).append("g").classed("display",!0).attr("transform","translate("+n+","+e+")"),c=700-n-a,i=450-e-r;this.plot(o,c,i,t)},e.prototype.plot=function(t,e,r,n){var a=u.scaleBand().domain(n.map(function(t){return t.label})).range([0,e]),o=u.scaleLinear().domain([0,u.max(n,function(t){return t.value})+1e3]).range([r,0]),c=u.scaleOrdinal(u.schemeCategory10);t.selectAll(".bar").data(n).enter().append("rect").classed("bar",!0).attr("x",function(t){return a(t.label)}).attr("y",function(t){return o(t.value)}).attr("height",function(t){return r-o(t.value)}).attr("width",function(t){return a.bandwidth()}).style("fill",function(t,e){return c(e)}),t.selectAll(".bar-label").data(n).enter().append("text").classed("bar-label",!0).attr("x",function(t){return a(t.label)+a.bandwidth()/2}).attr("dx",0).attr("y",function(t){return o(t.value)}).attr("dy",-6).text(function(t){return t.value});var i=u.axisBottom().scale(a);t.append("g").classed("x axis",!0).attr("transform","translate(0,"+r+")").call(i);var s=u.axisLeft().ticks(5).scale(o);t.append("g").classed("y axis",!0).attr("transform","translate(0,0)").call(s),t.select(".x.axis").append("text").attr("x",e/2).attr("y",60).attr("fill","#000").style("font-size","18px").style("text-anchor","middle").text("Fabricante ID"),t.select(".y.axis").append("text").attr("x",0).attr("y",0).attr("transform","translate(-50, "+r/2+") rotate(-90)").attr("fill","#000").style("font-size","18px").style("text-anchor","middle").text("Ventas");var l=u.axisLeft().scale(o).ticks(5).tickSize(-e,0,0).tickFormat("");t.append("g").call(l).classed("gridline",!0)},e}(a.a.Component),w=r(133);var x=function(t){function e(r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.state={showProductSelect:!1},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.handleChange=function(t){t?this.props.onSelect(t.value):this.props.clearManufacturer(),this.setState({showProductSelect:Boolean(t)})},e.prototype.handleChangeProduct=function(t){t?this.props.onSelectProduct(t.value):this.props.clearProduct()},e.prototype.getOptions=function(t){return t.map(function(t){return{value:parseInt(t),label:"Fabricante "+parseInt(t)}}).slice(0,100)},e.prototype.render=function(){var t=this.props,e=t.manufacturers,r=t.currentManufacturer,n=(t.currentProduct,t.products),o=(t.showProductSelect,this.getOptions(n),this.getOptions(e));return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"select-manufacturers pull-right"},a.a.createElement(w.a,{value:o.find(function(t){return t.value==r}),onChange:this.handleChange.bind(this),options:this.getOptions(e),isClearable:!0,placeholder:"Fabricante..."})))},e}(a.a.Component);var P=a.a.createElement(d.a,{xs:12,sm:12,md:8},a.a.createElement("h2",null,"Ventas por productos"),a.a.createElement("div",{className:"horizontal-bar-chart"})),E=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentDidMount=function(){this.drawChart()},e.prototype.drawChart=function(){var t=this.props.purchasesByProduct.slice(0,14),e=30,r=0,n=10,a=30,o=25*t.length+e+n,c=u.select(".horizontal-bar-chart").append("svg").attr("height",o).attr("width",600),i=u.scaleLinear().domain([0,u.max(t,function(t){return parseFloat(t.value.income)})]).range([a,600-r]),s=u.scaleBand().domain(t.map(function(t){return t.key})).range([e,o-n]).padding(.1),l=u.format(".3f");console.log("la data importada",t),c.append("g").attr("fill","steelblue").selectAll("rect").data(t).enter().append("rect").attr("x",i(0)).attr("y",function(t){return s(t.key)}).attr("width",function(t){return i(parseFloat(t.value.income))-i(0)}).attr("height",s.bandwidth()),c.append("g").attr("fill","white").attr("text-anchor","end").style("font","12px sans-serif").selectAll("text").data(t).enter().append("text").attr("x",function(t){return i(parseFloat(t.value.income))-4}).attr("y",function(t){return s(t.key)+s.bandwidth()/2}).attr("dy","0.35em").attr("dx","4em").attr("fill","#000").text(function(t){return l(parseFloat(t.value.income))}),c.append("g").call(function(t){return t.classed("x axis",!0).attr("transform","translate(0,"+o+")").call(u.axisBottom(i).ticks(7.5))}),c.append("g").call(function(t){return t.classed("y axis",!0).attr("transform","translate("+a+",0)").call(u.axisLeft(s).tickSizeOuter(0))}),c.select(".x.axis").append("text").attr("x",300).attr("y",40).attr("fill","#000").style("font-size","18px").style("text-anchor","middle").text("Ventas (€)"),c.select(".y.axis").append("text").attr("x",0).attr("y",0).attr("transform","translate(-50, "+o/2+") rotate(-90)").attr("fill","#000").style("font-size","18px").style("text-anchor","middle").text("Producto ID")},e.prototype.render=function(){return P},e}(a.a.Component),O=r(103);var B=a.a.createElement(d.a,{xs:12,sm:12,md:12},a.a.createElement("h2",null,"Ventas en el tiempo"),a.a.createElement("div",{className:"horizon-chart"})),_=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return r.state={data:[]},r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentWillReceiveProps=function(t){t.data.length!=this.props.data.length&&this.loadGraph(t.data)},e.prototype.componentWillMount=function(){this.loadGraph(this.props.data)},e.prototype.loadGraph=function(t){var e=this,r=t;r=r.map(function(t){return{name:t.product_id,date:function(t){return new Date(36e5*Math.round(t.getTime()/36e5))}(new Date(t.date_add)).getTime(),value:parseFloat(t.total_paid)}});var n=u.nest().key(function(t){return t.date}).entries(r).map(function(t){return t.key}).sort(u.ascending),a=u.nest().key(function(t){return t.name}).key(function(t){return t.date}).rollup(function(t){return t[0].value}).map(r),o=u.nest().key(function(t){return t.name}).rollup(function(t){return u.sum(t,function(t){return t.value})}).map(r);this.setState({data:{series:a.entries().sort(function(t,e){return o.get(e.key)-o.get(t.key)}).map(function(t){var e=t.key,r=t.value;return{name:e,values:n.map(function(t){return r.get(+t)?r.get(+t):0})}}),dates:n}},function(){return e.drawChart(e.state.data)})},e.prototype.render=function(){return this.drawChart(this.state.data),B},e.prototype.drawChart=function(t){var e=30,r=10,n=10,a=u.scaleUtc().domain(u.extent(t.dates)).range([0,964]),o=u.scaleLinear().domain([0,u.max(t.series,function(t){return u.max(t.values)})]).range([0,-115]),c=u.area().curve(u.curveBasis).defined(function(t){return!isNaN(t)}).x(function(e,r){return a(t.dates[r])}).y0(0).y1(function(t){return o(t)}),i=u.select(".horizon-chart").append("svg").attr("width",964).attr("height","auto").attr("viewBox","0,0,964,942").style("font","10px sans-serif"),s=i.append("g").selectAll("g").data(t.series).enter().append("g").attr("transform",function(t,r){return"translate(0,"+(24*r+e)+")"});s.append("clipPath").attr("id",function(t){return t.clip=Object(O.uniqueId)("clip")}).append("rect").attr("width",964).attr("height",23),s.append("defs").append("path").attr("id",function(t){return t.path=Object(O.uniqueId)("path")}).attr("d",function(t){return c(t.values)}),s.append("g").attr("clip-path",function(t){return"url("+window.location.origin+"/#"+t.clip+")"}).selectAll("use").data(function(t){return new Array(5).fill(t)}).enter().append("use").attr("fill",function(t,e){return function(t){return u.schemeRdPu[Math.max(3,5)][t+Math.max(0,-2)]}(e)}).attr("transform",function(t,e){return"translate(0,"+23*(e+1)+")"}).attr("xlink:xlink:href",function(t){return window.location.origin+"/#"+t.path}),s.append("text").attr("x",4).attr("y",11.5).attr("dy","0.35em").text(function(t){return t.name});return i.append("g").call(function(t){return t.attr("transform","translate(0,"+e+")").call(u.axisTop(a).ticks(12.05).tickSizeOuter(0)).call(function(t){return t.selectAll(".tick").filter(function(t){return a(t)<n||a(t)>=964-r}).remove()}).call(function(t){return t.select(".domain").remove()})}),i.node()},e}(a.a.Component);var M=r(200),k=r(201),S=r(132);var C=a.a.createElement("h3",{className:"pull-left"},a.a.createElement(S.a,null)," Dashboard de Ventas"),j=function(t){function e(r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return n.state={updating:!1,rawData:[],data:[],manufacturers:[],currentManufacturer:null,products:[],currentProduct:null,purchasesByManufacturer:[],purchasesByProduct:[]},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.componentWillMount=function(){var t=this,e=[];u.tsv("./pedidosCordenados.tsv",function(t){},function(t){e.push(t)}).then(function(r){var n=t.getPurchasesByManufacturer(e).sort(function(t,e){return e.value.income-t.value.income});t.setState({rawData:e,data:e,purchasesByManufacturer:n})})},e.prototype.componentWillUpdate=function(t,e){console.log("se dispara el will update")},e.prototype.filterItemsByManufacturer=function(t){var e=parseInt(t),r=this.filterData(t,this.state.currentProduct),n=this.getPurchasesByManufacturer(r).sort(function(t,e){return e.value.income-t.value.income}),a=this.getPurchasesByProduct(r).sort(function(t,e){return e.value.income-t.value.income});this.setState({data:r,currentManufacturer:e,purchasesByManufacturer:n,purchasesByProduct:a})},e.prototype.filterItemsByProduct=function(t){var e=parseInt(t),r=this.filterData(this.state.currentManufacturer,t),n=this.getPurchasesByManufacturer(r).sort(function(t,e){return e.value.income-t.value.income}),a=this.getPurchasesByProduct(r).sort(function(t,e){return e.value.income-t.value.income});this.setState({data:r,currentProduct:e,purchasesByManufacturer:n,purchasesByProduct:a})},e.prototype.filterData=function(t,e){return JSON.parse(JSON.stringify(this.state.rawData)).filter(function(r){return e&&t?r.id_manufacturer==t&&r.product_id==e:!t&&e?r.product_id==e:!(!e&&t)||r.id_manufacturer==t})},e.prototype.clearData=function(){this.setState({data:data})},e.prototype.clearOptionManufacturer=function(){location.reload()},e.prototype.clearOptionProduct=function(){var t=this.filterData(this.state.currentManufacturer,null),e=this.getPurchasesByManufacturer(t).sort(function(t,e){return e.value.income-t.value.income}),r=this.getPurchasesByProduct(t).sort(function(t,e){return e.value.income-t.value.income});this.setState({currentProduct:null,data:t,purchasesByManufacturer:e,purchasesByProduct:r})},e.prototype.getPurchasesByManufacturer=function(t){return u.nest().key(function(t){return t.id_manufacturer}).rollup(function(t){return{length:t.length,income:u.sum(t,function(t){return parseFloat(t.total_paid)})}}).entries(t)},e.prototype.getPurchasesByProduct=function(t){return u.nest().key(function(t){return t.product_id}).rollup(function(t){return{length:u.sum(t,function(t){return parseFloat(t.product_quantity)}),income:u.sum(t,function(t){return parseFloat(t.total_paid)})}}).entries(t)},e.prototype.getPurchasesByCity=function(){return u.nest().key(function(t){return t.city}).rollup(function(t){return{length:u.sum(t,function(t){return parseFloat(t.product_quantity)})}})},e.prototype.render=function(){var t=this.state,e=t.data,r=t.currentManufacturer,n=t.currentProduct,o=t.updating,u=t.purchasesByManufacturer,c=t.purchasesByProduct,i=c.map(function(t){return t.key}),s=u.map(function(t){return t.key});return console.log("el current manufacturer ",r),a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"App-instructions"},a.a.createElement("div",{className:"header"},C,a.a.createElement(x,{manufacturers:s,currentManufacturer:r,products:i,currentProduct:n,onSelect:this.filterItemsByManufacturer.bind(this),onSelectProduct:this.filterItemsByProduct.bind(this),clearProduct:this.clearOptionProduct.bind(this),clearManufacturer:this.clearOptionManufacturer.bind(this)}))),a.a.createElement("div",{className:"App-content"},!o&&a.a.createElement(M.a,{className:"container-fluid"},a.a.createElement(k.a,{className:"show-grid"},e.length&&a.a.createElement(b,{data:e}),r?a.a.createElement(E,{purchasesByProduct:c}):a.a.createElement(g,{currentManufacturer:r,purchasesByManufacturer:u,purchasesByProduct:c})),a.a.createElement(k.a,{className:"show-grid"},e.length&&a.a.createElement(_,{data:e})))))},e}(n.Component);Object(o.render)(a.a.createElement(j,null),document.querySelector("#app"))}},[[134,2,1]]]);
//# sourceMappingURL=app.bb9a820c.js.map